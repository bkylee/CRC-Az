name: Blob storage website CI

on:
  push:
    branches:
      - main
jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: bkylee/CRC-Az@main
        with:
          source_dir: "public"
          container_name: $web
          connection_string: ${{ secrets.SAFORBKYLEE_CONNECTION_STRING }}
          extra_args: "--pattern *.tar.gz"
          # WARNING: this will overwrite existing blobs in your blob storage
          overwrite: "true"
# on:
#   push:
#     branches: [main]

# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v3
#       - uses: azure/login@v1
#         with:
#           creds: ${{ secrets.AZURE_CREDENTIALS }}

#       - name: Upload to blob storage
#         uses: azure/CLI@v1
#         with:
#           inlineScript: |
#             az storage blob upload-batch --storage-account saforbkyl --auth-mode key -d '$web' -s ./ --overwrite true
#       - name: Purge CDN endpoint
#         uses: azure/CLI@v1
#         with:
#           inlineScript: |
#             az cdn endpoint purge --content-paths  "/*" --profile-name "testCDNProfile" --name "bkylee-endpoint" --resource-group "terraform_test_rg"

#       # Azure logout
#       - name: logout
#         run: |
#           az logout
#         if: always()
# https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-static-site-github-actions?tabs=userlevel
